<!DOCTYPE html>
<html>

<head>
  <title>SS23 crowd-report</title>

  <script src="https://www.gstatic.com/firebasejs/8.3.3/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.3.3/firebase-database.js"></script>
  <link rel="stylesheet" type="text/css" href="./js/leaflet.css" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.3/dist/leaflet.css" integrity="sha256-kLaT2GOSpHechhsozzB+flnD+zUyjE2LlfWPgU04xyI=" crossorigin="" />
  <script src="https://unpkg.com/leaflet@1.9.3/dist/leaflet.js" integrity="sha256-WBkoXOwTeyKclOHuWtc+i2uENFpDZ9YPdf5Hf+D7ewM=" crossorigin=""></script>

</head>

<body>
  Reporting: <input type="text" value="Meldender" style="width:40%" onchange="set_name=this.value;console.log('meldender geÃ¤ndert auf: '+set_name)">
  <br>
  <label for="numberInput">dens:</label>
  <input type="number" id="numberInput" name="numberInput" min="0" max="9" value =5 style="width:10%" onchange="set_dens= this.value">
  <br>
  <label for="numberInput2">tens:</label>
  <input type="number" id="numberInput2" name="numberInput" min="0" max="9" value =5 style="width:10%" onchange="set_tens= this.value">
  <br>
  <label for="numberInput3">usage:</label>
  <input type="number" id="numberInput3" name="numberInput" min="0" max="100" step=5 value =50 style="width:10%" onchange="set_usage= this.value">
  <br>
  <label for="dropdown">Zone:</label>
  <select id="dropdown" name="dropdown" onchange="set_area = this.value;">
  <option value="bigbeast">bigbeast</option>
  <option value="vendor">vendor</option>
  <option value="downbeast">downbeast</option>
  </select>
  <br><br><br>
  <!-- Button to trigger the data write -->
  <button onclick="writeToFirebase()">Send report</button>
  <div id="map_div" style="width:500px;height:500px;background-color: blueviolet;"></div>
<hr>

  wo bleibt das commit?
</body>

<script>
    const firebaseConfig = {
        apiKey: "AIzaSyBOOdW1SHCwBZSchUJ7DfJZ1a7-dEYTvuQ",
        authDomain: "crowdcount-678c8.firebaseapp.com",
        databaseURL: "https://crowdcount-678c8-default-rtdb.europe-west1.firebasedatabase.app",
        projectId: "crowdcount-678c8",
        storageBucket: "crowdcount-678c8.appspot.com",
        messagingSenderId: "1020533758948",
        appId: "1:1020533758948:web:23ec6e175dff3b5eedc5f1",
        measurementId: "G-00674BETEZ"
        };

  set_pos =[0,0];
  set_name ="ds"
  set_area="oben"
  set_dens="unk"
  set_tens = "unk"

  var mymap = L.map('map_div',{zoomSnap: 0.001}).setView(set_pos,10 )
 //        mymap.on('zoomend', function() {setviewzoom = mymap.getZoom()});
   //   mymap.on('moveend', function() { mapaa = (mymap.getCenter(),mymap.getCenter());setviewmap=[mapaa.lat,mapaa.lng]});
   L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{
      
     // opacity: 0.5,
      attribution: '&copy; <a href="https://openstreetmap.org/copyright">OpenStreetMap contributors</a>'
    }).addTo(mymap);

    let touchStartX, touchEndX;

mymap.getContainer().addEventListener("touchstart", function (e) {
    touchStartX = e.touches[0].clientX;
});

mymap.getContainer().addEventListener("touchend", function (e) {
    touchEndX = e.changedTouches[0].clientX;
  console.log(touchStartX,touchEndX)
  })


    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);

    // Function to write data to the Firebase database
    function writeToFirebase() {

      navigator.geolocation.getCurrentPosition(
            (position) => {
                // Extract latitude and longitude from the position object
                const latitude = position.coords.latitude;
                const longitude = position.coords.longitude;
             set_pos =[latitude,longitude]
    mymap.setView(set_pos,5)
              // Display the user's position information
             //  console.log(`Latitude: ${latitude}, Longitude: ${longitude}`)
            },
            (error) => {
                // Handle any errors that occur during geolocation
                console.log(`Error: ${error.message}`)
            }
         
        );


        setTimeout(function (){
      jetzt = new Date()
      
      const database = firebase.database();

      // Replace 'your-data' with the path where you want to write the data in the database
      // For example, if you want to write data to 'https://your-project-id.firebaseio.com/users', use 'users'
      const databaseRef = database.ref('soundstorm').child('SS23').child(jetzt.getTime());

      // Data you want to write to the database



      const dataToWrite = {
        zeit: jetzt.getTime(),
        name: set_name,
        area: set_area,
        density: set_dens,
        position: set_pos,
        tension: set_tens,
      };

     // Push the data to the database
      databaseRef.set(dataToWrite)
        .then(() => {
          console.log("Data was successfully written to the Firebase database.");
        })
        .catch((error) => {
          console.error("Error writing data to the Firebase database:", error);
        });
},3000)


    }



  </script>

</html>
