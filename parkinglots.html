<!DOCTYPE html>

<html lang="en">

<head>
  <title>SS23 parkinglots</title>
  <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-app-compat.js"></script>
        <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-auth-compat.js"></script>
        <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-database-compat.js"></script>
        <script src="./js/d3.min.js"></script>
        <script src="https://cdn.plot.ly/plotly-2.16.1.min.js"></script>
   
        <script src="./data.js"></script>
      
        <link rel="stylesheet" type="text/css" href="./js/leaflet.css" />
        <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.3/dist/leaflet.css" integrity="sha256-kLaT2GOSpHechhsozzB+flnD+zUyjE2LlfWPgU04xyI=" crossorigin="" />
        <script src="https://unpkg.com/leaflet@1.9.3/dist/leaflet.js" integrity="sha256-WBkoXOwTeyKclOHuWtc+i2uENFpDZ9YPdf5Hf+D7ewM=" crossorigin=""></script>
        <script src="./function.js"></script>
</head>
<body>
  <div id="sliders">
    <span>Parking lot 1</span> <input id="sl1" type="range" min="0" max="100" step=10 value =0 onchange="
      d3.select('#span1').text(this.value+' %')
      report_parking(1,this.value)
      "> <span id="span1"> 0 %</span><br>

       <span>Parking lot 2</span> <input id="sl2" type="range" min="0" max="100" step=10 value =0 onchange="
       d3.select('#span2').text(this.value+' %')
       report_parking(2,this.value)
       "> <span id="span2"> 0 %</span><br>

         <span>Parking lot 3</span> <input id="sl3" type="range" min="0" max="100" step=10 value =0 onchange="
         d3.select('#span3').text(this.value+' %')
         report_parking(3,this.value)
         "> <span id="span3"> 0 %</span><br>

           <span>Parking lot 4</span> <input id="sl4" type="range" min="0" max="100" step=10 value =0 onchange="
           d3.select('#span4').text(this.value+' %')
           report_parking(4,this.value)
           "> <span id="span4"> 0 %</span><br>

           
       <span>Parking lot 5</span> <input id="sl5" type="range" min="0" max="100" step=10 value =0 onchange="
       d3.select('#span5').text(this.value+' %')
       report_parking(5,this.value)
       "> <span id="span5"> 0 %</span><br>

         <span>Parking lot 6</span> <input id="sl6" type="range" min="0" max="100" step=10 value =0 onchange="
         d3.select('#span6').text(this.value+' %')
         report_parking(6,this.value)
         "> <span id="span6"> 0 %</span><br>
         
           <span>Parking lot 7</span> <input id="sl7" type="range" min="0" max="100" step=10 value =0 onchange="
           d3.select('#span7').text(this.value+' %')
           report_parking(7,this.value)
           "> <span id="span7"> 0 %</span><br>


  </div>
  <p id="infotag">Version 1.1 - loaded</p>
</body>
<script>
  infotag = d3.select('#infotag')
  initialise_firebase()
   database = firebase.database();

   ref = database.ref('/soundstorm/aktuell');

ref.on('value', (snapshot) => {

current = snapshot.val()

d3.select('#sl1').attr("value",current["parking lot 1"].usage);d3.select('#span1').text(current["parking lot 1"].usage+' %') 
d3.select('#sl2').attr("value",current["parking lot 2"].usage);d3.select('#span2').text(current["parking lot 2"].usage+' %')
d3.select('#sl3').attr("value",current["parking lot 3"].usage);d3.select('#span3').text(current["parking lot 3"].usage+' %')
d3.select('#sl4').attr("value",current["parking lot 4"].usage);d3.select('#span4').text(current["parking lot 4"].usage+' %')
d3.select('#sl5').attr("value",current["parking lot 5"].usage);d3.select('#span5').text(current["parking lot 5"].usage+' %')
d3.select('#sl6').attr("value",current["parking lot 6"].usage);d3.select('#span6').text(current["parking lot 6"].usage+' %')
d3.select('#sl7').attr("value",current["parking lot 7"].usage);d3.select('#span7').text(current["parking lot 7"].usage+' %')

})

function report_parking(lot,value){
  databaseRef = database.ref('soundstorm').child('aktuell').child("parking lot "+lot);
  jetzt = new Date ()
        databaseRef.set({usage:value,zeit:jetzt.getTime()})
  infotag.text("report sent for lot " + lot + " at : " + jetzt )
}

</script>