<!DOCTYPE html>
<html>

<head>
  <title>SS23 crowd-report</title>
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.3/dist/leaflet.css" integrity="sha256-kLaT2GOSpHechhsozzB+flnD+zUyjE2LlfWPgU04xyI=" crossorigin="" />

  <script src="https://unpkg.com/leaflet@1.9.3/dist/leaflet.js" integrity="sha256-WBkoXOwTeyKclOHuWtc+i2uENFpDZ9YPdf5Hf+D7ewM=" crossorigin=""></script>
  <script src="https://d3js.org/d3.v7.min.js"></script>
  <script src="https://unpkg.com/leaflet-polylinedecorator/dist/leaflet.polylineDecorator.js"></script>

  <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-database-compat.js"></script>
  <script src="./data.js"></script>
 
  <!--
   <script src="./js/d3.min.js"></script>
  <script src="./js/leaflet.js"></script>
  <link rel="stylesheet" type="text/css" href="./js/leaflet.css" />


  -->
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>

<body>
  <div id="diver" style="width:100%;height:100%;overflow:hidden">
 

</div>
 
</body>

<script>
  swipes_db = []
    initialise_firebase()
   read_swipes()
   // update_ownpos()
/*
setInterval(function() {

//read_swipes()


setTimeout(function(){
list_swipes()
},1000)
  }, 5000);
*/
list_swipes()
  function list_swipes(){
    d3.select('#diver').selectAll('*').remove()
    console.table(swipes_db.length)
    
    Object.keys(swipes_db).forEach((key) => {
    a = new Date()
      a =a.getTime()
    if(a-swipes_db[key].zeit<30*60*1000)
 // const value = swipes_db[key];
//  console.log(`Key: ${key}, Value: ${value}`);
 { d3.select('#diver').append('p').text("F: "+swipes_db[key].meldender)
}});
  
    
    
  }
function initialise_firebase(){
const firebaseConfig = {
        apiKey: "AIzaSyBOOdW1SHCwBZSchUJ7DfJZ1a7-dEYTvuQ",
        authDomain: "crowdcount-678c8.firebaseapp.com",
        databaseURL: "https://crowdcount-678c8-default-rtdb.europe-west1.firebasedatabase.app",
        projectId: "crowdcount-678c8",
        storageBucket: "crowdcount-678c8.appspot.com",
        messagingSenderId: "1020533758948",
        appId: "1:1020533758948:web:23ec6e175dff3b5eedc5f1",
        measurementId: "G-00674BETEZ"
        };
// Initialize Firebase
firebase.initializeApp(firebaseConfig);


      }  
function read_swipes (){

    database = firebase.database();
  
ref = database.ref('/soundstorm/swipes');

ref.on('value', (snapshot) => {

  swipes_db = snapshot.val()

});
 }
  

 database = firebase.database();
  
  ref = database.ref('/soundstorm/SS23/day0/Dance Tent');
  
  ref.on('value', (snapshot) => {
  
    swes_db = snapshot.val()
  
  })
  
  setTimeout(function(){console.table(swes_db)
  
  console.log(swes_db.length)
  console.table(swes_db[3])
  
  },5000)
  </script>

</html>
